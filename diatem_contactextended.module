<?php
// $Id$
/**
* @file
* Module Diatem
* Ajouter des champs dans le formulaire de contact du site
* Credits: http://willvincent.com/blog/adding-one-or-more-fields-drupal-7-contact-form
*/

/**
* Implements hook_form_FORM_ID_alter().
*/
function diatem_contactextended_form_contact_site_form_alter(&$form, &$form_state) {
    // Add a required textfield to collect
	$form['company'] = array(
		'#title'    => t('Company'),
		'#type'     => 'textfield',
		'#required' => TRUE,
	);

    // Re-sort the form so that we can ensure our field appears
    // in the right spot. We're going to do this by building an array of the
    // form field keys, then looping through each and setting their weight.
    //
    // Default fields on the contact form are:
    // name    (Users Name)
    // mail    (Users Email Address)
    // subject (Email Subject)
    // cid     (Category select list, only visible if multiple contact categories are defined)
    // message (Message textarea)
    // copy    ('Send me a copy' checkbox)
    // submit  (Submit button)

	$order = array(
		'name',
		'mail',
		'company',
		'subject',
		'cid',
		'message',
		'copy',
		'submit'
		);

	foreach ($order as $key => $field) {
        // Set/Reset the field's
        // weight to the array key value
        // from our order array.
		$form[$field]['#weight'] = $key;
	}
}

/**
* Implements hook_mail_alter().
*/
function diatem_contactextended_mail_alter(&$message) {
    // We only want to alter the email if it's being
    // generated by the site-wide contact form page.
	if ($message['id'] == 'contact_page_mail') {
		$message['body'][] = t('Phone') .': '. $message['params']['company'];
	}
}

?>